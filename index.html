// check関数の中身をこのように賢くしました！
function check() {
    const s = steps[cur]; 
    const activeCell = document.getElementById(s.id);
    if(!activeCell) return;
    
    const val = activeCell.querySelector('.num-display').textContent;
    
    // 正解判定
    if(val !== "" && parseInt(val) === s.ans) {
        processCorrect(activeCell);
    } else {
        combo = 0;
        activeCell.querySelector('.num-display').textContent = "";
    }
}

function processCorrect(cell) {
    combo++;
    // (コンボ演出などはそのまま)
    cell.classList.remove('input','active');
    cell.style.color="blue";
    soundMagic.play();
    cur++;

    if(cur >= steps.length) {
        gameClear();
    } else {
        // 【ここがポイント！】次のマスの答えが「先頭の0」なら自動で埋めてスキップ
        const nextStep = steps[cur];
        if (nextStep.ans === 0 && (nextStep.id.endsWith('100') || nextStep.id.endsWith('1000'))) {
            const nextCell = document.getElementById(nextStep.id);
            nextCell.querySelector('.num-display').textContent = ""; // 画面上は見せない
            nextCell.classList.remove('input','active');
            cur++;
            if(cur >= steps.length) gameClear();
            else update();
        } else {
            update();
        }
    }
}
